const toggle = document.getElementById("statusToggle");
const body = document.body;
const dog = document.getElementById("dogImage");
const alertMessage = document.getElementById("alertMessage");
const timeRemaining = document.getElementById("timeRemaining");

function setStatus(status) {
  if (status === "away") {
    body.style.backgroundColor = "#ffcccc"; // red
    dog.style.backgroundImage = "url('sad-dog.png')";
    toggle.checked = false;
    localStorage.setItem("leaveTime", Date.now());
    timeRemaining.style.display = "block";
  } else {
    body.style.backgroundColor = "#ccffcc"; // green
    dog.style.backgroundImage = "url('happy-dog.png')";
    toggle.checked = true;
    alertMessage.innerText = "";
    timeRemaining.innerText = "";
    timeRemaining.style.display = "none";
  }

  localStorage.setItem("homeStatus", status);
}

toggle.addEventListener("change", () => {
  if (toggle.checked) {
    setStatus("home");
  } else {
    setStatus("away");
  }
});

window.onload = function () {
  const saved = localStorage.getItem("homeStatus") || "home";
  setStatus(saved);
};

function checkTimeLimit() {
  const status = localStorage.getItem("homeStatus");
  const leaveTime = parseInt(localStorage.getItem("leaveTime") || "0");

  if (status === "away") {
    const now = Date.now();
    const diffMs = now - leaveTime;
    const diffMin = Math.floor(diffMs / (1000 * 60));
    const minsLeft = 1 - diffMin;

    if (minsLeft <= 0) {
      alertMessage.innerText = "⏰ Time limit reached! Please check in.";
      timeRemaining.innerText = "";
    } else {
      alertMessage.innerText = "";
      timeRemaining.innerText = `${minsLeft} min`;
    }
  } else {
    alertMessage.innerText = "";
    timeRemaining.innerText = "";
  }
}

setInterval(checkTimeLimit, 1000);
checkTimeLimit();
